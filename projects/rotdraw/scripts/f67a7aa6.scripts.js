"use strict";angular.module("RotDrawApp",[]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("RotDrawApp").controller("MainCtrl",["$scope",function(a){function b(a){this.ctx=a,this.points=[]}function c(a,b,c){return this.dependsOn=c||[],this._x=a,this._y=b,this}function d(a){if(a=a||{},this.len=a.len||0,this.prev=a.prev||!1,this.prev){var b=new c(this.prev.point.x+this.len,this.prev.point.y);this.prev.point.dependsOn.push(b),this.point=b}else this.point=new c(150,150);this.angular=a.angular||0,this.onMove=function(){}}function e(a){this.ctx=a,this.nodes=[],this.nodes.push(new d)}b.prototype={addPoint:function(a,b){this.points.push({x:a,y:b})},render:function(){var a=this.points,b=this.ctx;if(!(a.length<6)){b.lineWidth=1,b.lineJoin="round",b.lineCap="round",b.strokeStyle="rgba(0,0,0,0.3)",b.beginPath(),b.moveTo(a[0].x,a[0].y);for(var c=1;c<a.length-2;c++){var d=(a[c].x+a[c+1].x)/2,e=(a[c].y+a[c+1].y)/2;b.quadraticCurveTo(a[c].x,a[c].y,d,e)}b.quadraticCurveTo(a[c].x,a[c].y,a[c+1].x,a[c+1].y),b.stroke()}},clearPath:function(){this.points=[]}},c.prototype={set x(a){this.onMove(this.x-a,0),this._x=a},get x(){return this._x},set y(a){this.onMove(0,this.y-a),this._y=a},get y(){return this._y},onMove:function(a,b){for(var c in this.dependsOn)this.dependsOn[c].x=this.dependsOn[c].x-a,this.dependsOn[c].y=this.dependsOn[c].y-b}},d.prototype={set _len(a){this.len&&this.prev&&(this.point.y=(this.point.y-this.prev.point.y)/this.len*a+this.prev.point.y,this.point.x=(this.point.x-this.prev.point.x)/this.len*a+this.prev.point.x),this.len=a},get _len(){return this.len},move:function(a){this.point.x=a.x,this.point.y=a.y},attach:function(a){this.onMove=a},detach:function(){this.onMove=function(){}}},e.prototype={addNode:function(a){a.prev=this.nodes[this.nodes.length-1],this.nodes.push(new d(a))},chainedRotation:function(){for(var a=0;a<this.nodes.length;a++){var b,c,d,e=this.nodes[a],f=this.nodes[a-1];b=f?f.point:{x:150,y:150},c=Math.sin(e.angular),d=Math.cos(e.angular),e.onMove(e);var g=e.point.x-b.x,h=e.point.y-b.y;e.move({x:g*d-h*c+b.x,y:g*c+h*d+b.y})}},render:function(){var a=this.ctx;a.beginPath(),a.moveTo(this.nodes[0].point.x,this.nodes[0].point.y);for(var b=1;b<this.nodes.length;b++){var c=this.nodes[b];a.lineTo(c.point.x,c.point.y)}a.strokeStyle="rgba(200,0,0,1.0)",a.stroke()}};var f,g;a.setup=function(c){g=new e(c),f=new b(c),g.addNode(new d({len:20,angular:-.01})),a.nodes=g.nodes,a.clearPath=function(){f.clearPath()},a.addNode=function(){g.nodes[g.nodes.length-1].detach(),g.addNode(new d({len:20,angular:.01})),g.nodes[g.nodes.length-1].attach(function(a){f.addPoint(a.point.x,a.point.y)})}},a.draw=function(){g.chainedRotation(),f.render(),g.render()}}]),angular.module("RotDrawApp").directive("jslider",function(){return{restrict:"EA",scope:{jslider:"=jslider",jsliderMin:"=jsliderMin",jsliderMax:"=jsliderMax",jsliderDiv:"=jsliderDiv",jsliderSlide:"=jsliderSlide"},link:function(a,b){b.slider({min:a.jsliderMin||0,max:a.jsliderMax||100,values:[a.jslider],slide:function(b,c){a.$apply(function(){a.jslider=c.value/(a.jsliderDiv||1)})}})}}}),angular.module("RotDrawApp").directive("ngCanvas",function(){return{restrict:"EA",scope:{draw:"=ngCanvasDraw",setup:"=ngCanvasSetup",width:"=ngCanvasWidth",frameRate:"=ngCanvasFrameRate",height:"=ngCanvasHeight"},link:function(a,b){var c=function(){var c=document.createElement("canvas");this.width=c.width=a.width,this.height=c.height=a.height,this.ctx=c.getContext("2d"),this.canvas=c,b.append(this.canvas)};c.prototype={draw:function(b){var c=this;this.ctx.clearRect(0,0,this.width,this.height),b(this.ctx),setTimeout(function(){c.draw(b)},a.frameRate)}};var d=new c;a.setup(d.ctx),d.draw(a.draw)}}});